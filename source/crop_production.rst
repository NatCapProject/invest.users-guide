.. _crop_production:

***************
Crop Production
***************

Summary
=======

.. figure:: ./crop_production_images/field.png
   :align: right
   :figwidth: 200pt




Introduction
============
 Expanding agricultural production and closing yield gaps is a key strategy for many governments and development agencies focused on poverty alleviation and achieving food security. However, conversion of natural habitats to agricultural production sites impacts other ecosystem services that are key to sustaining the economic benefits that agriculture provides to local communities. Intensive agricultural practices can add to pollution loads in water sources, often necessitating future costly water purification methods. Overuse of water also threatens the supply available for hydropower or other services. Still, crop production is essential to human well-being and livelihoods. The InVEST crop production model allows detailed examination of the costs and benefits of this vital human enterprise, allowing exploration of questions such as:

* How would different arrangement or selection of cropping systems compare to current systems in terms of total production? Could switching crops yield higher economic returns or nutritional value?

* What are the impacts of crop intensification on ecosystem services? If less land is used to produce equal amounts of food by increasing intensification, is the net result on ecosystem services production positive or negative?

* How can we evaluate different strategies for meeting increasing food demand while minimizing impact on ecosystem services?

The Model
=========

The InVEST crop production model will produce estimates of crop yield, from existing data, percentile summaries, and modeled predictions.  For existing or modeled crop yields, the model can also generate estimates of crop value.  

*Existing data*: The crop yield model supplies existing yields, based on FAO and sub-national datasets for 175 crops, as tons/ha (Monfreda et al. 2008). If a crop type submitted by the user is not grown in that region, the model will not return a value for those pixels; crops can be moved around within a region in which they are grown, but novel cropping systems cannot be introduced in minimum mode. The model will also return existing inputs for that crop (in that region), as percent of land irrigated (for 15 crops for which there are data), and amount of N, P, and K applied/ha (for 140 crops for which there are data). The model can provide nutrition information for all crops and economic production if additional cost information is provided for fertilizer, nutrients, labor, seed, and machinery (this information is already included in the model for 12 staple crops in 2012: barley, maize, oil palm, potato, rapeseed, rice, rye, soybean, sugar beet, sugar cane, sunflower, and wheat).

*Percentile summaries*: This option allow the user to explore yields under different management scenarios, picking from a range of “intensification” levels.  The user can supply a percentile raster, with each pixel of agricultural land coded 25, 50, 75, or 95 as a proxy for low, medium, high, or maximum productivity, presumably achieved under corresponding degrees of intensification. This will return the 25th, 50th, 75th, or 95th percentile yields, respectively, for the crop of interest in all regions of similar climate and income. The user also has an option to select a World Bank Income Classification to explore different productivity levels possible under different income conditions, with accompanying assumptions about how this would change their access to technology or other capital. This feature is optional and should be interpreted with caution (i.e., the feasibility of moving from one income category to another), and if the user does not make a selection the model will use the actual income classification for that region. Because there is no information about the actual quantities of fertilizer and irrigation needed to achieve these different percentiles of production, this option does not allow economic valuation of production, but can provide nutrition production information if desired.

*Modeled yields*: For 12 staple crops for which yields have been modeled globally by Mueller et al. (2011), the model can provide estimates of both yields and inputs (fertilizer and irrigation), in the same units as above. These crops include barley, maize, oil palm, potato, rapeseed, rice, rye, soybean, sugar beet, sugar cane, sunflower, and wheat. To run this model, the user must provide rasters of nitrogen, phosphate, and potash application rate (kg/ha) and an irrigation raster (0 for pixels that are not irrigated and 1 for pixels that are) that cover all cropped areas of interest. The model returns crop yields and economic and nutritional value.

The crop value model can use the yields and/or inputs generated by the yield model, or can be run with yield maps derived from other models or data sources (e.g., SSURGO). Crop yields can be valued in terms of economic returns or in terms of nutrition. To calculate economic returns, the model requires yield maps, as well as maps of fertilizer and irrigation rates corresponding to those yields, and combines this information with crop price and cost datasets to calculate the total expected returns (yields x area x price – inputs x input costs – area x other costs). To calculate nutrition, the model only requires yield maps of all food crops produced, and the user can select from 33 macro and micronutrients to map or summarize. This model can be combined with our nutrition demand model, which multiplies population density by recommended daily allowances of the same nutrients, to determine what proportion of nutritional requirements can be met from local food production.


How it Works
------------

Modeled Yields
^^^^^^^^^^^^^^

.. math:: Y_{modGC} = min(Y_{max}(1-b_{NP}*e^{(-C_N N_{GC})}), Y_{max}(1-b_{NP}*e^{(-C_P N_{GC})}), Y_{max}(1-b_{NP}*e^{(-C_K N_{GC})}))


Limitations and Simplifications
-------------------------------
The current version of the model is a coarse global model driven mostly by climate and optionally by management. This model is therefore not able to capture the variation in productivity that occurs across heterogeneous landscapes. A rocky hill slope and a fertile river valley, if they share the same climate, would be assigned the same yield in the current model. This is a problem if the question of interest is where: where to prioritize future habitat conversion; or where farming is most productive and least destructive.

Spatial downscaling of the current coarse global model is necessary to make the crop model more useful in local land-use decisions. Our approach will be to acquire local yield data that can be compared to the modeled yields to determine where the model is overestimating yields and where it is underestimating. The resulting differences can be related to other variables such as slope, aspect, elevation, soil fertility, and soil depth, and any significant relationships can be used to refine the current model. The coarse model will still be used to arrive at the general magnitude of yield for a given climate and intensification level, and the finer-scale differences will essentially tune the coarse model up or down. To do this we need:
*	Field-level (or better) yield data across a wide representation of soils, topographies and climates
*	Soil and topographic data at the same level of resolution as the yield data
If you have or intend to take such data and are interested in collaborating with us, please contact Becky Chaplin-Kramer at bchaplin@stanford.edu



Data Needs
==========

The model uses seven possible types of input data (only two are required).

1. ** LULC map (required).** A GIS raster dataset (e.g., tif, .grd, .img), with LULC class code for each cell (e.g., 1 for forest, 2 for corn, 3 for soy, etc.). The LULC class codes should be in the grid's 'value' column. The raster should not contain any other data. The LULC codes must match the codes in the "Crop type" table below (input # 2). The dataset should be in a projection where the units are in meters and the projection used should be defined.


2. **Crop type table (required):** A table (.csv, .xls, or .dbf) relating the ID codes in your LULC map to the crop types you wish to consider. 

 *Rows:* Each row is a different land-use or crop type.

 *Columns:* must be named as follows:

	a. ID: the number for each LULC type in your LULC map 
	
	b. CROP: a string corresponding exactly to the list of possible crop types below 
	
Example: Hypothetical LULC map with 6 land uses: forest (1), corn (2), soy (3), rice (4), wheat (5), and grassland (6). Note that only the agricultural land-uses are defined in this table, corresponding to the list of 175 crops in Appendix A. If strings are used in the "CROP" column are not recognized they will be ignored. The non-agricultural land-uses can also be left blank, as in this example.

==   ======== 
ID   CROP 
==   ========
1	            
2    corn        
3    soy
4    rice
5    wheat
6	              
==   ======== 

3. ** Intensification raster (optional, for percentile summary).** A GIS raster dataset, with the desired percentile designated for each cell. Only one of the four percentile options (25, 50, 75, 95) should be used; other values will return an error.

4. **Nitrogen application raster (optional, for modeled yields).** A GIS raster dataset, with a numeric values for amount of N (kg/ha) applied on each cell. These can be decimal values or integers.


5. **Phosphate application raster (optional, for modeled yields).** A GIS raster dataset, with a numeric values for amount of P2O5 (kg/ha) applied on each cell. These can be decimal values or integers.

6. **Potash application raster (optional, for modeled yields).** A GIS raster dataset, with a numeric values for amount of K2O (kg/ha) applied on each cell. These can be decimal values or integers.

7. **Irrigation raster (optional, for modeled yields).** A GIS raster dataset, designating which pixels on the landscape are irrigated with either a 1 (irrigated) or 0 (non-irrigated, rainfed). Only 0 or 1 should be used; other values will return an error.


Running the Model
=================

The model is available as a standalone application accessible from the Windows start menu.  For Windows 7 or earlier, this can be found under *All Programs -> InVEST +VERSION+ -> Crop production*.  Windows 8 users can find the application by pressing the windows start key and typing "crop production" to refine the list of applications.  The standalone can also be found directly in the InVEST install directory under the subdirectory *invest-3_x86/invest_crop_production.exe*.

Viewing Output from the Model
-----------------------------

Upon successful completion of the model, a file explorer window will open to the output workspace specified in the model run.  This directory contains an *output* folder holding files generated by this model.  Those files can be viewed in any GIS tool such as ArcGIS, or QGIS.  These files are described below in Section :ref:`interpreting-results`.

.. _interpreting-results:

Interpreting Results
--------------------

Final results are found in the *Output* folder within the *Workspace* specified for this module.

* **Parameter log**: Each time the model is run, a text (.txt) file will appear in the *Output* folder. The file will list the parameter values for that run and will be named according to the service, the date and time, and the suffix. 



Optional Output Files
^^^^^^^^^^^^^^^^^^^^^


Appendix I - Metadata
=====================

Crops
-----

.. csv-table::
  :file: ./crop_production/crops.csv
  :header-rows: 1
  :name: Crops Metadata


Fertilizer
----------

Band 1: Kg/ha

Band 2: Precison

.. csv-table::
  :file: ./crop_production/fertilizer_metadata.csv
  :header-rows: 1
  :name: Fertilizer Metadata

* any previous number + .25 = any one of the previous data types but scaling of application rates was maxed out at a doubling when trying to match the FAO consumption


Appendix II - Statistics
========================

Climate Bin Fertilizer
----------------------

Barley
^^^^^^
.. csv-table::
  :file: ./crop_production/barley_fertilizer.csv
  :header-rows: 1
  :name: Barley Fertilizer

Maize
^^^^^
.. csv-table::
  :file: ./crop_production/maize_fertilizer.csv
  :header-rows: 1
  :name: Maize Fertilizer

Oilpalm
^^^^^^^
.. csv-table::
  :file: ./crop_production/oilpalm_fertilizer.csv
  :header-rows: 1
  :name: Oilpalm Fertilizer

Potato
^^^^^^
.. csv-table::
  :file: ./crop_production/potato_fertilizer.csv
  :header-rows: 1
  :name: Potato Fertilizer

Rice
^^^^
.. csv-table::
  :file: ./crop_production/rice_fertilizer.csv
  :header-rows: 1
  :name: Rice Fertilizer

Rye
^^^
.. csv-table::
  :file: ./crop_production/rye_fertilizer.csv
  :header-rows: 1
  :name: Rye Fertilizer

Soybean
^^^^^^^
.. csv-table::
  :file: ./crop_production/soybean_fertilizer.csv
  :header-rows: 1
  :name: Soybean Fertilizer

Sugarbeet
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sugarbeet_fertilizer.csv
  :header-rows: 1
  :name: Sugarbeet Fertilizer

Sugarcane
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sugarcane_fertilizer.csv
  :header-rows: 1
  :name: Sugarcane Fertilizer

Sunflower
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sunflower_fertilizer.csv
  :header-rows: 1
  :name: Sunflower Fertilizer

Wheat
^^^^^
.. csv-table::
  :file: ./crop_production/wheat_fertilizer.csv
  :header-rows: 1
  :name: Wheat Fertilizer

Climate Bin Correlation Coefficient
-----------------------------------

Barley
^^^^^^
.. csv-table::
  :file: ./crop_production/barley_statistics.csv
  :header-rows: 1
  :name: Barley Statistics

Maize
^^^^^
.. csv-table::
  :file: ./crop_production/maize_statistics.csv
  :header-rows: 1
  :name: Maize Statistics

Oilpalm
^^^^^^^
.. csv-table::
  :file: ./crop_production/oilpalm_statistics.csv
  :header-rows: 1
  :name: Oilpalm Statistics

Potato
^^^^^^
.. csv-table::
  :file: ./crop_production/potato_statistics.csv
  :header-rows: 1
  :name: Potato Statistics

Rice
^^^^
.. csv-table::
  :file: ./crop_production/rice_statistics.csv
  :header-rows: 1
  :name: Rice Statistics

Rye
^^^
.. csv-table::
  :file: ./crop_production/rye_statistics.csv
  :header-rows: 1
  :name: Rye Statistics

Soybean
^^^^^^^
.. csv-table::
  :file: ./crop_production/soybean_statistics.csv
  :header-rows: 1
  :name: Soybean Statistics

Sugarbeet
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sugarbeet_statistics.csv
  :header-rows: 1
  :name: Sugarbeet Statistics

Sugarcane
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sugarcane_statistics.csv
  :header-rows: 1
  :name: Sugarcane Statistics

Sunflower
^^^^^^^^^
.. csv-table::
  :file: ./crop_production/sunflower_statistics.csv
  :header-rows: 1
  :name: Sunflower Statistics

Wheat
^^^^^
.. csv-table::
  :file: ./crop_production/wheat_statistics.csv
  :header-rows: 1
  :name: Wheat Statistics


References
==========
Monfreda et al. 2008
Mueller et al. 2012
