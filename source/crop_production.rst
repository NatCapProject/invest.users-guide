.. _crop_production:

***************
Crop Production
***************

Summary
=======

.. figure:: ./crop_production_images/field.png
   :align: center
   :scale: 60%

Introduction
============

Expanding agricultural production and closing yield gaps is a key strategy for many governments and development agencies focused on poverty alleviation and achieving food security. However, conversion of natural habitats to agricultural production sites impacts other ecosystem services that are key to sustaining the economic benefits that agriculture provides to local communities. Intensive agricultural practices can add to pollution loads in water sources, often necessitating future costly water purification methods. Overuse of water also threatens the supply available for hydropower or other services. Still, crop production is essential to human well-being and livelihoods. The InVEST crop production model allows detailed examination of the costs and benefits of this vital human enterprise, allowing exploration of questions such as:

+ How would different arrangement or selection of cropping systems compare to current systems in terms of total production? Could switching crops yield higher economic returns or nutritional value?

+ What are the impacts of crop intensification on ecosystem services? If less land is used to produce equal amounts of food by increasing intensification, is the net result on ecosystem services production positive or negative?

+ How can we evaluate different strategies for meeting increasing food demand while minimizing impact on ecosystem services?

The Model
=========

The InVEST crop production model will produce estimates of crop yield, from existing data, percentile summaries, and modeled predictions.  For existing or modeled crop yields, the model can also generate estimates of crop value.

*Observed data*: The crop yield model supplies observed yields, based on FAO and sub-national datasets for 175 crops, as tons/ha (Monfreda et al. 2008). If a crop type submitted by the user is not grown in that region, the model will not return a value for those pixels; crops can be moved around within a region in which they are grown, but novel cropping systems cannot be introduced in minimum mode. The model will also return existing inputs for that crop (in that region), as percent of land irrigated (for 15 crops for which there are data), and amount of N, P, and K applied/ha (for 140 crops for which there are data). The model can provide nutrition information for all crops and economic production if additional cost information is provided for fertilizer, nutrients, labor, seed, and machinery (this information is already included in the model for 12 staple crops in 2012: barley, maize, oil palm, potato, rapeseed, rice, rye, soybean, sugar beet, sugar cane, sunflower, and wheat).

*Percentile summaries*: This option allow the user to explore yields under different management scenarios, picking from a range of “intensification” levels.  The user can supply a percentile raster, with each pixel of agricultural land coded 25, 50, 75, or 95 as a proxy for low, medium, high, or maximum productivity, presumably achieved under corresponding degrees of intensification. This will return the 25th, 50th, 75th, or 95th percentile yields, respectively, for the crop of interest in all regions of similar climate and income. The user also has an option to select a World Bank Income Classification to explore different productivity levels possible under different income conditions, with accompanying assumptions about how this would change their access to technology or other capital. This feature is optional and should be interpreted with caution (i.e., the feasibility of moving from one income category to another), and if the user does not make a selection the model will use the actual income classification for that region. Because there is no information about the actual quantities of fertilizer and irrigation needed to achieve these different percentiles of production, this option does not allow economic valuation of production, but can provide nutrition production information if desired.

*Modeled yields*: For 12 staple crops for which yields have been modeled globally by Mueller et al. (2011), the model can provide estimates of both yields and inputs (fertilizer and irrigation), in the same units as above. These crops include barley, maize, oil palm, potato, rapeseed, rice, rye, soybean, sugar beet, sugar cane, sunflower, and wheat. To run this model, the user must provide rasters of nitrogen, phosphate, and potash application rate (kg/ha) and an irrigation raster (0 for pixels that are not irrigated and 1 for pixels that are) that cover all cropped areas of interest. The model returns crop yields and economic and nutritional value.

The crop value model can use the yields and/or inputs generated by the yield model, or can be run with yield maps derived from other models or data sources (e.g., SSURGO). Crop yields can be valued in terms of economic returns or in terms of nutrition. To calculate economic returns, the model requires yield maps, as well as maps of fertilizer and irrigation rates corresponding to those yields, and combines this information with crop price and cost datasets to calculate the total expected returns (yields x area x price – inputs x input costs – area x other costs). To calculate nutrition, the model only requires yield maps of all food crops produced, and the user can select from 33 macro and micronutrients to map or summarize. This model can be combined with our nutrition demand model, which multiplies population density by recommended daily allowances of the same nutrients, to determine what proportion of nutritional requirements can be met from local food production.


How it Works
------------

Calculating Yield
^^^^^^^^^^^^^^^^^

Method 1: Observed Yields within a Given Region
"""""""""""""""""""""""""""""""""""""""""""""""

  .. math:: Production_{crop,x,y} = { ObservedLocalYield_{crop,x,y} * LULCCropCellArea_{x,y} }

  .. math:: ProductionTotal_{crop} = \sum_{x,y}{ Production_{crop,x,y} }


Method 2: Climate-Specific Distribution of Observed Yields
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

  .. math:: Yield_{crop,percentile,x,y} = ObservedClimateBinYield_{crop,climatebin,precentile}\left[ ClimateBin_{crop,x,y} \right]

  .. math:: Production_{crop,percentile,x,y} = Yield_{crop,percentile,x,y} * LULCCropCellArea_{x,y}

  .. math:: ProductionTotal_{crop,percentile} = \sum_{x,y}{ Production_{crop,percentile,x,y} }

Method 3: Yield Regression Model with Climate-specific Parameters
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

  .. math:: PercentMaxYieldNitrogen_{x,y} = \left( 1 - Bnp_{crop,climatebin} * e^{-Cn_{crop,climatebin} * NitrogenAppRate_{x,y}} \right)

  .. math:: PercentMaxYieldPhosphorous_{x,y} = \left( 1 - Bnp_{crop,climatebin} * e^{-Cp_{crop,climatebin} * PhosphorousAppRate_{x,y}} \right)

  .. math:: PercentMaxYieldPotassium_{x,y} = \left( 1 - Bk_{crop,climatebin} * e^{-Ck_{crop,climatebin} * PotassiumAppRate_{x,y}} \right)

  .. math:: MaxYieldNitrogen_{x,y} = MaxYield_{crop,climatebin} * PercentMaxYieldNitrogen_{x,y}

  .. math:: MaxYieldPhosphorous_{x,y} = MaxYield_{crop,climatebin} * PercentMaxYieldPhosphorous_{x,y}

  .. math:: MaxYieldPotassium_{x,y} = MaxYield_{crop,climatebin} * PercentMaxYieldPotassium_{x,y}

  If Rainfed:

    .. math:: Yield_{crop,x,y} = min\left( MaxYieldNitrogen, MaxYieldPhosphorous, MaxYieldPotassium, MaxYieldRainfed  \right)

  If Irrigated:

    .. math:: Yield_{crop,x,y} = min\left( MaxYieldNitrogen, MaxYieldPhosphorous, MaxYieldPotassium \right)

  .. math:: Production_{crop,x,y} = Yield_{crop,x,y} * LULCCropCellArea_{x,y}

  .. math:: ProductionTotal_{crop} = \sum_{x,y}{ Production_{crop,x,y} }

Calculating Nutrition Contents from Yield
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  .. math:: NutrientAmount_{crop, nutrient} = NutrientAmountPerTonCrop_{crop, nutrient} * ProductionTotal_{crop}

  .. math:: NutrientAmountTotal_{nutrient} = \sum_{crops}{ NutrientAmount_{crop, nutrient} }

Calculating Economic Returns from Yield
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

  .. math:: CostPerTonInputTotal_{crop} = \sum_{x,y | crop = LULCCrop_{x,y}}{ \left( \sum_{fertilizer}{  FertAppRate_{fertilizer,x,y} * LULCCropCellArea_{x,y} * CostPerTon_{fertilizer} } \right) }

  .. math:: CostPerHectareInputTotal_{crop} = CropHarvestArea * \sum_{inputs}{CostPerHectare_{input}}

  .. math:: Cost_{crop} = CostPerTonInputTotal_{crop} + CostPerHectareInputTotal_{crop}

  .. math:: Revenue_{crop} = Production_{crop} * Price_{crop}

  .. math:: Returns_{crop} = Revenue_{crop} - Cost_{crop}

  .. math:: ReturnsTotal = \sum_{crops} Returns_{crop}


Limitations and Simplifications
-------------------------------
The current version of the model is a coarse global model driven mostly by climate and optionally by management. This model is therefore not able to capture the variation in productivity that occurs across heterogeneous landscapes. A rocky hill slope and a fertile river valley, if they share the same climate, would be assigned the same yield in the current model. This is a problem if the question of interest is where: where to prioritize future habitat conversion; or where farming is most productive and least destructive.

Spatial downscaling of the current coarse global model is necessary to make the crop model more useful in local land-use decisions. Our approach will be to acquire local yield data that can be compared to the modeled yields to determine where the model is overestimating yields and where it is underestimating. The resulting differences can be related to other variables such as slope, aspect, elevation, soil fertility, and soil depth, and any significant relationships can be used to refine the current model. The coarse model will still be used to arrive at the general magnitude of yield for a given climate and intensification level, and the finer-scale differences will essentially tune the coarse model up or down. To do this we need:

+	Field-level (or better) yield data across a wide representation of soils, topographies and climates

+	Soil and topographic data at the same level of resolution as the yield data

If you have or intend to take such data and are interested in collaborating with us, please contact Becky Chaplin-Kramer at bchaplin@stanford.edu



Data Needs
==========




Running the Model
=================

**General Parameters**

1. **Workspace Folder**  The selected folder is used as the workspace where all intermediate and final output files will be written.  If the selected folder does not exist, it will be created.  If datasets already exist in the selected folder, they will be overwritten.

2. **Results Suffix (Optional)**  This text will be appended to the end of the output files to help seperate outputs from multiple runs.

3. **Land-Use/Land-Cover Map (Raster)**  A GDAL-supported raster representing a crop management scenario. Each cell value in the raster should be a valid integer code that corresponds to a crop in the Crop Lookup Table CSV file.

  +---+---+
  |int|int|
  +---+---+
  |int|int|
  +---+---+

4. **Crop Lookup Table (CSV)**  A CSV table used to convert the crop code provided in the Crop Map to the crop name that can be used for searching through inputs and formatting outputs.  The provided CSV file should contain a table with two columns: a 'crop' column and a 'code' column.  The 'crop' column contains the names of each crop used in the model, and the 'code' column contains the associated code used to represent that crop in the Crop Map.

  ====  =====
  code  crop
  ====  =====
  1     corn
  2     soy
  3     rice
  ...   ...
  ====  =====

**Parameters for Yield Based on Observed Yields within Region**

5. **Observed Crop Yield Maps (Rasters)**  A set of GDAL-supported rasters representing the observed crop yield.  Each cell value in the raster should be a non-negative float value representing the amount of crop produced in units of tons per hectare (tons/ha).

  +-----+-----+
  |float|float|
  +-----+-----+
  |float|float|
  +-----+-----+

**Parameters for Yield Functions Based on Climate**

6. **Crop Climate-Bin Maps (Rasters)**  A set of GDAL-supported rasters representing the climate-bin that a given area of land is located within for each particular crop.  Each raster contains a set of values between 0 and 100.  Zero-values represent areas that do not exist within a climate-bin, such as an ocean.  Values 1 through 100 correspond to a particular climate-bin.

  +---+---+
  |int|int|
  +---+---+
  |int|int|
  +---+---+

**Parameters for Yield Based on Climate-specific Distribution of Observed Yields**

7. **Percentile Yield Table (CSV)**  The provided CSV table should contain information about the average crop yield occuring within each climate-bin across several income levels for each crop.  The table must have a 'crop' column matching a value in the 'crop' column on the Crop Lookup Table. The table must have a 'climate_bin' column containing values 1 through 100.  The table must have at least one additional column representing a percentile yield within the given climate-bin for a particular crop - an example set of columns could be: 'yield_25th', 'yield_50th', 'yield_75th', 'yield_95th'.  So, this example table would have the following columns: 'crop', 'climate_bin', 'yield_25th', 'yield_50th', 'yield_75th', 'yield_95th'.

  ====  ===========  ==========  ==========  ==========  ==========  ===
  crop  climate_bin  yield_25th  yield_50th  yield_75th  yield_95th  ...
  ====  ===========  ==========  ==========  ==========  ==========  ===
  corn  1            <float>     <float>     <float>     <float>     ...
  rice  2            <float>     <float>     <float>     <float>     ...
  soy   3            <float>     <float>     <float>     <float>     ...
  ...   ...          ...         ...         ...         ...         ...
  ====  ===========  ==========  ==========  ==========  ==========  ===

**Parameters for Yield based on Yield Regression Model with Climate-specific Parameters**

8. **Modeled Yield Table (CSV)**  The provided CSV table should contain information useful for calculating the yield of a crop located in a particular climate-bin based on the limiting factor.  The table must have the following columns: 'climate_bin', 'yield_ceiling', 'yield_ceiling_rf', 'b_nut', 'b_K2O', 'c_N', 'c_P2O5', 'c_K2O'.  The usefulness of the Modeled Yield function is limited to a select group of crops.  [[[Note about the limited number of crops that this method is useful for]]]

  ====  ===========  =============  ================  =======  =======  =======  =======  =======
  crop  climate_bin  yield_ceiling  yield_ceiling_rf  b_nut    b_K2O    c_N      c_P2O5   c_K2O
  ====  ===========  =============  ================  =======  =======  =======  =======  =======
  corn  1            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  corn  2            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  corn  3            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  ...   ...          ...            ...               ...      ...      ...      ...      ...
  soy   1            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  soy   2            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  soy   3            <float>        <float>           <float>  <float>  <float>  <float>  <float>
  ...   ...          ...            ...               ...      ...      ...      ...      ...
  ====  ===========  =============  ================  =======  =======  =======  =======  =======

9. **Fertilizer Application Rate Maps (Rasters)**  A set of GDAL-supported rasters representing the amount of Nitrogen (N), Phosphorous (P2O5), and Potash (K2O) applied to each area of land. Each cell value in the raster should be a non-negative float value representing the amount of fertilizer applied in units of kilograms per hectare (kg/ha).

  +-----+-----+
  |float|float|
  +-----+-----+
  |float|float|
  +-----+-----+

10. **Irrigation Map (Raster)**  A GDAL-supported raster representing whether irrigation occurs or not. A zero value indicates that no irrigation occurs.  A one value indicates that irrigation occurs.  If any other values are provided, irrigation is assumed to occur within that cell area.

  +---+---+
  |int|int|
  +---+---+
  |int|int|
  +---+---+

**Parameters for Nutrient Contents from Yield**

11. **Nutrient Contents Table (CSV)**  A CSV table containing information about the nutrient contents of each crop.

  ====  ==============  =======  =======  =======  =======  =======  =======  =======  ===
  crop  percent_refuse  protein  lipid    energy   ca       fe       mg       ph       ...
  ====  ==============  =======  =======  =======  =======  =======  =======  =======  ===
  corn  <float>         <float>  <float>  <float>  <float>  <float>  <float>  <float>  ...
  soy   <float>         <float>  <float>  <float>  <float>  <float>  <float>  <float>  ...
  ...   ...             ...      ...      ...      ...      ...      ...      ...      ...
  ====  ==============  =======  =======  =======  =======  =======  =======  =======  ===

**Parameters for Economic Returns from Yield**

12. **Economics Table (CSV)**  A CSV table containing information related to market price of a given crop and the expenses involved with producing that crop.

  ====  =======  =============  ================  ===========  ==========  =========  =========  ===============
  crop  price    cost_nitrogen  cost_phosphorous  cost_potash  cost_labor  cost_mach  cost_seed  cost_irrigation
  ====  =======  =============  ================  ===========  ==========  =========  =========  ===============
  corn  <float>  <float>        <float>           <float>      <float>     <float>    <float>    <float>
  soy   <float>  <float>        <float>           <float>      <float>     <float>    <float>    <float>
  ...   ...      ...            ...               ...          ...         ...        ...        ...
  ====  =======  =============  ================  ===========  ==========  =========  =========  ===============

13. **Fertilizer Application Rate Maps (Rasters) (Optional)**  A set of GDAL-supported rasters representing the amount of Nitrogen (N), Phosphorous (P2O5), and Potash (K2O) applied to each area of land. Each cell value in the raster should be a non-negative float value representing the amount of fertilizer applied in units of kilograms per hectare (kg/ha).

  +-----+-----+
  |float|float|
  +-----+-----+
  |float|float|
  +-----+-----+

Interpreting Results
====================

**Outputs**

1. **Yield Results Table (CSV)** A unique CSV file will be created for each yield function that is run.

  ====  ==========  ============  =========  =========  ==========  ==========  ==========  ======
  crop  production  (percentile)  (returns)  (revenue)  (expenses)  nutrient_a  nutrient_b  (etc.)
  ====  ==========  ============  =========  =========  ==========  ==========  ==========  ======
  corn  <float>     yield_25th    <float>    <float>    <float>     <float>     <float>     ...
  soy   <float>     yield_25th    <float>    <float>    <float>     <float>     <float>     ...
  ...   ...         ...           ...        ...        ...         ...         ...         ...
  ====  ==========  ============  =========  =========  ==========  ==========  ==========  ======

2. **Crop Production Maps (Rasters)** A set of GDAL-supported rasters representing the total production for each crop.  Each cell value in the raster shall be a non-negative float value representing the total production over the cell's area under the given scenario in units of tons.

  +-----+-----+
  |float|float|
  +-----+-----+
  |float|float|
  +-----+-----+

3. **Economic Returns Map (Raster)**  A GDAL-supported raster representing the economic returns generated by the crops.  Each cell value in the raster shall be a non-negative float value representing the returns (revenue minus costs) generated under the given scenario in units of the currency from the user-provided Economics Table. [[[What about nodata values? default to zero or use a nodata value?]]]

  +-----+-----+
  |float|float|
  +-----+-----+
  |float|float|
  +-----+-----+



References
==========
Monfreda et al. 2008
Mueller et al. 2012



Appendix I - Metadata
=====================

Crops
-----

Fertilizer
----------

Band 1: Kg/ha

Band 2: Precison

* any previous number + .25 = any one of the previous data types but scaling of application rates was maxed out at a doubling when trying to match the FAO consumption


Appendix II - Statistics
========================

Climate Bin Fertilizer
----------------------


Climate Bin Correlation Coefficient
-----------------------------------
